<div class="green-port">
    <h1 class="green-port__title animate-text-top">ЗЕЛЕНЫЙ ПОРТ</h1>
    <div class="green-port__quote animate-text-top">Мы живем во Владивостоке, любим его, растим здесь детей и чувствуем свою ответственность за его будущее.</div>

    <div class="green-port__green-port-cards green-port-cards">
        <div class="green-port-cards__item green-port__leaves">
            <img src="/img/leaves-2.png" class="green-port-leaves green-port-leaves-1 fade-in" alt="">
            <div class="green-port__fade fade-in">
                <div class="green-port-cards__wrapper">
                    <video class="green-port-cards__preview" playsinline autoplay muted loop>
                        <source src="/img/green-port-preview-1.mp4" type="video/mp4">
                    </video>
                </div>
                <div class="green-port-cards__content">Ведем свою деятельность ответственно и безопасно</div>
            </div>
        </div>
        <div class="green-port-cards__item fade-in">
            <div class="green-port-cards__wrapper">
                <video class="green-port-cards__preview" playsinline autoplay muted loop>
                    <source src="/img/green-port-preview-2.mp4" type="video/mp4">
                </video>
            </div>
            <div class="green-port-cards__content">Бережно относимся <br>к природе</div>
        </div>
        <div class="green-port-cards__item fade-in">
            <div class="green-port-cards__wrapper">
                <video class="green-port-cards__preview" playsinline autoplay muted loop>
                    <source src="/img/green-port-preview-3.mp4" type="video/mp4">
                </video>
            </div>
            <div class="green-port-cards__content">Обеспечиваем работой тысячи жителей города</div>
        </div>
    </div>
    
    <div class="green-port__green-motivation green-port-motivation green-port__leaves">
        <h2 class="green-port-motivation__title green-port__subtitle">улучшаем жизнь города</h2>
        <div class="green-port-motivation__description">В нашей работе мы стремимся к высочайшим стандартам производственной безопасности, заботимся о благополучии и здоровье наших сотрудников, соблюдаем строгие требования по защите окружающей среды.</div>
        <img src="/img/leaves-1.png" class="green-port-leaves green-port-leaves-2" alt="">
    </div>

    <div class="green-port__green-port-map fullscreen-block2 green-port-map-wrapper">
        <div id="green-port-map" class="green-port-map"></div>
    </div>
    
    <h3 class="green-port__caption green-port__focusing-efforts animate-text-top animation-off">ФОКУСИРУЕМ УСИЛИЯ <br>И РЕСУРСЫ НА УЛУЧШЕНИИ КАЧЕСТВА ЖИЗНИ СОТРУДНИКОВ И ОБЩЕСТВА</h3>

    <div class="green-port__speedometers">
        <div class="green-port__speedometer-wrapper">
            <div id="speedometer-1" data-pos-start="90" data-pos-end="5" class="speedometer green-port__speedometer green-port__leaves">
                <img src="/img/leaves-3.png" class="green-port-leaves green-port-leaves-3" alt="">
                <div class="speedometer__wrapper">
                    <img src="/img/speedometer.svg" class="speedometer__scale" alt="">
                    <img src="/img/speedometer-line.svg" class="speedometer__line" alt="">
                    <div class="speedometer__caption">мг/куб.метр</div>
                </div>

                <div class="speedometer__title">уровень    пыли</div>
            </div>
            
            <div class="green-port__file-blocks">
                <a href="#" class="file-block green-port__file-block" target="_blank">
                    <div class="file-block__file">
                        @@include('../components/svg/file.html')
                        <div class="file-block__type">pdf</div>
                    </div>

                    <div class="file-block__content">
                        <div class="file-block__title">Протокол испытаний от 16.12.22</div>

                        <div class="file-block__size">
                            32,45 kB
                            <div class="file-block__download">@@include('../components/svg/download.html')</div>
                        </div>
                    </div>
                </a>
                <a href="#" class="file-block green-port__file-block" target="_blank">
                    <div class="file-block__file">
                        @@include('../components/svg/file.html')
                        <div class="file-block__type">pdf</div>
                    </div>

                    <div class="file-block__content">
                        <div class="file-block__title">Архив протоколов испытаний замеров атмосферного воздуха</div>

                        <div class="file-block__size">
                            32,45 kB
                            <div class="file-block__download">@@include('../components/svg/download.html')</div>
                        </div>
                    </div>
                </a>
            </div>
        </div>

        <div class="green-port__speedometer-wrapper">
            <div id="speedometer-2" data-pos-start="90" data-pos-end="10" class="speedometer green-port__speedometer">
                <div class="speedometer__wrapper">
                    <img src="/img/speedometer.svg" class="speedometer__scale" alt="">
                    <img src="/img/speedometer-line.svg" class="speedometer__line" alt="">
                    <div class="speedometer__caption">мг/литр</div>
                </div>

                <div class="speedometer__title">Уровень    чистоты    воды</div>
            </div>

            <div class="green-port__file-blocks">
                <a href="#" class="file-block green-port__file-block" target="_blank">
                    <div class="file-block__file">
                        @@include('../components/svg/file.html')
                        <div class="file-block__type">pdf</div>
                    </div>

                    <div class="file-block__content">
                        <div class="file-block__title">Протокол испытаний от 16.12.22</div>

                        <div class="file-block__size">
                            32,45 kB
                            <div class="file-block__download">@@include('../components/svg/download.html')</div>
                        </div>
                    </div>
                </a>
                <a href="#" class="file-block green-port__file-block" target="_blank">
                    <div class="file-block__file">
                        @@include('../components/svg/file.html')
                        <div class="file-block__type">pdf</div>
                    </div>

                    <div class="file-block__content">
                        <div class="file-block__title">Архив протоколов испытаний замеров воды</div>

                        <div class="file-block__size">
                            32,45 kB
                            <div class="file-block__download">@@include('../components/svg/download.html')</div>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
    
    <div class="green-port__news-project">
        <h2 class="green-port__subtitle green-port__news-title">
            <span class="animate-text-top animation-off">
                Новости проекта
            </span>
            <a href="#" class="green-port__news-all" target="_blank">Все новости</a></h2>

        <div class="news-cards">
            <a href="#" class="news-card green-port__news-card" target="_blank">
                <div class="news-card__date data-label">14.10.2022</div>
                <img class="news-card__img" src="img/temp/press-service-1.webp" alt="Руководство FESCO и региона вручили награды портовикам" width="378" height="256">
                <div class="news-card__content">
                    Руководство FESCO и региона вручили награды портовикам
                </div>
            </a>

            <a href="#" class="news-card green-port__news-card" target="_blank">
                <div class="news-card__date data-label">14.10.2022</div>
                <img class="news-card__img" src="img/temp/press-service-1.webp" alt="Руководство FESCO и региона вручили награды портовикам" width="378" height="256">
                <div class="news-card__content">
                    Руководство FESCO и региона вручили награды портовикам
                </div>
            </a>

            <a href="#" class="news-card green-port__news-card" target="_blank">
                <div class="news-card__date data-label">14.10.2022</div>
                <img class="news-card__img" src="img/temp/press-service-1.webp" alt="Руководство FESCO и региона вручили награды портовикам" width="378" height="256">
                <div class="news-card__content">
                    Руководство FESCO и региона вручили награды портовикам
                </div>
            </a>
        </div>
    </div>

    <div class="fullscreen-block2 green-port-possibilities green-port__green-port-possibilities">
        <div class="container green-port-possibilities__container">
            <div class="green-port-possibilities__col">
                <h2 class="green-port__subtitle green-port-possibilities__title animate-text-top animation-off">Море возможностей</h2>
                <div class="green-port-possibilities__description">Ежегодно транспортная группа FESCO и ВМТП совместно <br>с АНО «Развитие» проводят грантовый конкурс «Море возможностей», помогая в решении наиболее острых социальных проблем Приморья.</div>
            
                <div class="green-port-possibilities__statistics-request">
                    <div class="green-port-possibilities__statistics">
                        <div class="green-port-possibilities__num">191</div>
                        <div class="green-port-possibilities__name">заявок поступило на конкурс</div>
                    </div>
                    <div class="green-port-possibilities__statistics">
                        <div class="green-port-possibilities__num">92</div>
                        <div class="green-port-possibilities__name">заявки получили поддержку</div>
                    </div>
                </div>
            </div>
            
            <div class="green-port-possibilities__col green-port-possibilities__statistics-others">
                <div class="green-port-possibilities__statistics">
                    <div class="green-port-possibilities__num">27 500 000</div>
                    <div class="green-port-possibilities__name">рублей объем социальных инвестиций</div>
                </div>
                <div class="green-port-possibilities__statistics">
                    <div class="green-port-possibilities__num">25 500+</div>
                    <div class="green-port-possibilities__name">благополучателей получили помощь в рамках проектов-победителей</div>
                </div>
                <div class="green-port-possibilities__statistics">
                    <div class="green-port-possibilities__num">3 000+</div>
                    <div class="green-port-possibilities__name">волонтеров участвовало <br>в проектах</div>
                </div>
            </div>
        </div>
    </div>
    
    <h3 class="green-port__tasks green-port__caption animate-text-top animation-off">Задачи конкурса</h3>
    <div class="green-port-tasks green-port__green-port-tasks">
        <div class="green-port-tasks__item">
            <img src="/img/circle-growth-1.svg" class="green-port-tasks__icon" width="88px" height="88px" alt="">
            Реализовывать проекты <br>для повышения качества жизни в Приморье
        </div>
        <div class="green-port-tasks__item">
            <img src="/img/circle-home.svg" class="green-port-tasks__icon" width="88px" height="88px" alt="">
            Внедрять инновационные технологии устойчивого развития
        </div>
        <div class="green-port-tasks__item">
            <img src="/img/circle-growth-2.svg" class="green-port-tasks__icon" width="88px" height="88px" alt="">
            Развивать институты местных сообществ
        </div>
        <div class="green-port-tasks__item">
            <img src="/img/circle-growth-3.svg" class="green-port-tasks__icon" width="88px" height="88px" alt="">
            Развивать социальное <br>и корпоративное волонтерство
        </div>
    </div>
    
    <div class="green-port__green-port-gallery green-port-gallery">
        <div class="green-port-gallery__header">
            <div class="animate-text-top animation-off"><h2 class="green-port-gallery__title green-port__subtitle">Фотогалерея</h2></div>
            
            
            <div class="green-port-gallery__buttons">
                <div class="circle btn green-port-gallery-btn swiper-btn prev">@@include('../components/svg/arrow.html')</div>
                <div class="circle btn green-port-gallery-btn swiper-btn next">@@include('../components/svg/arrow.html')</div>
            </div>
        </div>

        <div class="swiper-cards fullscreen-block2">
            <div class="container">
                <div class="swiper swiper-cards__swiper green-port-gallery__swiper">
                    <div class="swiper-wrapper">
                        <img src="/img/temp/green-port-gallery-1.jpg" class="swiper-card swiper-slide green-port-gallery__card" width="600px" height="338px" alt="">
                        <img src="/img/temp/green-port-gallery-2.jpg" class="swiper-card swiper-slide green-port-gallery__card" width="600px" height="338px" alt="">
                        <img src="/img/temp/green-port-gallery-3.jpg" class="swiper-card swiper-slide green-port-gallery__card" width="600px" height="338px" alt="">
                        <img src="/img/temp/green-port-gallery-1.jpg" class="swiper-card swiper-slide green-port-gallery__card" width="600px" height="338px" alt="">
                        <img src="/img/temp/green-port-gallery-2.jpg" class="swiper-card swiper-slide green-port-gallery__card" width="600px" height="338px" alt="">
                        <img src="/img/temp/green-port-gallery-3.jpg" class="swiper-card swiper-slide green-port-gallery__card" width="600px" height="338px" alt="">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="fullscreen-block2 green-port-work green-port__green-port-work">
        <div class="container green-port-work__container">
            <h2 class="green-port__subtitle green-port-work__title animate-text-top animation-off">СОЗДАЕМ РАБОЧИЕ МЕСТА И РАЗВИВАЕМ РЕГИОНЫ</h2>
            <div class="green-port-work__description">Подать заявку на участие в конкурсе</div>
            <a href="#" class="btn btn_third green-port-work__btn" target="_blank">Заполнить онлайн-анкету</a>
        </div>
        <img src="/img/green-port-work.jpg" class="green-port-work__preview" width="960px" height="619px" alt="">
    </div>
</div>

<script src="https://api-maps.yandex.ru/2.1/?apikey=e2cdd9b4-793c-44ff-bfb7-908e17ad7400&lang=ru_RU" type="text/javascript"></script>
<script defer>
    const mapPoints = [
        {
            coordsPoint: [43.092287, 131.862955],
            content: {
                coords: [43.107658, 131.835798],
                photoSrc: '/img/temp/green-port-map-1.jpg',
                text: 'Построили детскую площадку на ул. Морозова, 5'
            }
        },
        {
            coordsPoint: [43.093064, 131.865569],
            content: {
                coords: [43.107658, 131.835798],
                photoSrc: '/img/temp/green-port-map-2.jpg',
                text: 'Построили детскую площадку на ул. Саратовская, 10'
            }
        },
        {
            coordsPoint: [43.100388, 131.865266],
            content: {
                coords: [43.100388, 131.835798],
                photoSrc: '/img/temp/green-port-map-3.jpg',
                text: 'Высадили 55 ясеней в сквере Героев-Даманцев'
            }
        }
    ]
    
    ymaps.ready(() => {
        const map = new ymaps.Map("green-port-map", {
            center: [43.097, 131.862955],
            controls: [],
            zoom: 15
        });
        
        map.behaviors.disable('scrollZoom');
        
        const lines = [];
        const placemarks = [];
        const cards = [];

        map.events.add('actiontick', () => lines.forEach(line => line.position()));

        mapPoints.forEach(({ coordsPoint, content: { coords, photoSrc, text } }, idx) => {
            const placemarkTemplate = ymaps.templateLayoutFactory.createClass(`<div id="placemark-${idx}-start" class="green-port-map__wrapper"></div>`);
            
            const placemark = new ymaps.Placemark(
                coordsPoint, 
                {}, 
                {
                    iconLayout: placemarkTemplate,
                    iconShape: {
                        type: 'Rectangle',
                        coordinates: [
                            [0, 0], [44, 44]
                        ]
                    },
                }
            );
            map.geoObjects.add(placemark);
            
            const cardTemplate = ymaps.templateLayoutFactory.createClass(`<div id="placemark-${idx}-end" class="green-port-map__card hide"><img src="{{ properties.photoSrc }}" alt="" class="green-port-map__img"/>{{ properties.text }}</div>`);
            const card = new ymaps.Placemark(
                coords,
                {
                    photoSrc, text
                },
                {
                    iconLayout: cardTemplate,
                }
            );
            map.geoObjects.add(card);

            let htmlPlacemark = null;
            const getPlacemark = () => {
                if (!htmlPlacemark) {
                    htmlPlacemark = placemark.getOverlaySync().getLayoutSync().getElement().children[0];
                    placemarks.push(htmlPlacemark);
                }
                
                return htmlPlacemark;
            };

            let htmlCard = null;
            const getCard = () => {
                if (!htmlCard) {
                    htmlCard = card.getOverlaySync().getLayoutSync().getElement().children[0];
                    cards.push(htmlCard);
                }

                return htmlCard;
            };

            placemark.events.add('mouseenter', function () {
                getPlacemark().classList.add('hover');
            });

            placemark.events.add('mouseleave', function () {
               getPlacemark().classList.remove('hover');
            });
            
            let line = null;
            const getLine = () => {
                if (!line) {
                    line = new LeaderLine(
                        LeaderLine.pointAnchor(getPlacemark(), { x: '45%', y: '45%'}),
                        getCard(),
                        {
                            color: '#3A861F',
                            size: 3,
                            dash: true,
                            endPlug: 'disc',
                            endPlugSize: 2,
                            hide: true
                        }
                    );
                    
                    lines.push(line);
                }

                return line;
            };

            placemark.events.add('click', function () {
                placemarks.forEach(placemark => placemark.classList.remove('selected'));
                getPlacemark().classList.add('selected');

                cards.forEach(card => card.classList.add('hide'));
                getCard().classList.remove('hide');

                lines.forEach(line => line.hide());
                getLine().position();
                getLine().show('draw');
            });
        });
    });
    
    class Speedometer {
        constructor(id) {
            this.element = document.querySelector(`#${id}`);
            this.start = +this.element.getAttribute('data-pos-start');
            this.end = +this.element.getAttribute('data-pos-end');
            this.line = this.element.querySelector('.speedometer__line');

            this.setRotate(this.start);
            this.line.style.transition = '1.1s all';
        }

        setRotate(val) {
            this.line.style.transform = `translateX(-100%) rotate(${val}deg)`
        }

        toEnd() {
            this.setRotate(this.end);
        }
    }

    const firstSpeedometer = new Speedometer('speedometer-1');
    const secondSpeedometer = new Speedometer('speedometer-2');

    new IntersectionObserver(([entry]) => {
        if (entry.isIntersecting) {
            firstSpeedometer.toEnd();
            secondSpeedometer.toEnd();
        }
    }, {
        threshold: 1
    }).observe(document.querySelector('.green-port__speedometers'));


    document.querySelectorAll('.animation-off').forEach(el => {
        new IntersectionObserver((entries) => {
            entries.forEach(({ isIntersecting }) => {
                if (isIntersecting) {
                    el.classList.remove('animation-off');
                }
            })
        }, {
            threshold: 0.5
        }).observe(el.nextElementSibling);
    })
    
    document.addEventListener("DOMContentLoaded", () => {
        new Swiper(".green-port-gallery__swiper", {
            navigation: {
                nextEl: ".green-port-gallery-btn.next",
                prevEl: ".green-port-gallery-btn.prev",
            },
            
            slidesPerView: 'auto',
            
            breakpoints: {
                0: {
                    spaceBetween: 13
                },
                411: {
                    spaceBetween: 27
                },
                641: {
                    spaceBetween: 30
                },
            }
        });
    })
</script>